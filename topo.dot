digraph Algorithm {
    compound=true
    node [shape=Mrecord, style=filled, fillcolor=white]
    edge [arrowtail=empty]

    subgraph cluster_Inputs {
        label="Inputs"
        style="dashed"

        Target [label="{Target|FQDN\nname}"]
        Hint   [label="{Hint|ADDR\nserver}"]
    }

    subgraph Down {
        Down_send   [label="{Down/SOA|ADDR ⨉ FQDN\nserver, qname}"]
        Down_nodata [label="{Down/Nodata|ADDR ⨉ FQDN\nserver, qname}"]
        Down_answer [label="{Down/Ans|ADDR ⨉ FQDN\nserver, qname}"]
        Down_glue   [label="{Down/RefGlue|FQDN ⨉ ADDR\nqname, glue}"]
        Down_ref    [label="{Down/Ref|FQDN ⨉ FQDN\nqname, nsdname}"]
        Down_send -> Down_nodata [label="0..1", style=dotted]
        Down_send -> Down_answer [label="0..1", style=dotted]
        Down_send -> Down_glue [label="0..", style=dotted]
        Down_send -> Down_ref [label="0..", style=dotted]
    }

    subgraph Siblings {
        Siblings_send [label="{Siblings/NS|ADDR ⨉ FQDN\nserver, qname}"]
        Siblings_glue [label="{Siblings/AnsGlue|FQDN ⨉ ADDR\nqname, glue}"]
        Siblings_ans  [label="{Siblings/Ans|FQDN ⨉ FQDN\nqname, nsdname}"]
        Siblings_send -> Siblings_glue [label="0..", style=dotted]
        Siblings_send -> Siblings_ans [label="0..", style=dotted]
    }

    subgraph Self {
        Self_send   [label="{Self/SOA|ADDR ⨉ FQDN\nserver, qname}"]
        Self_answer [label="{Self/Ans|ADDR ⨉ FQDN\nserver, qname}"]
        Self_send -> Self_answer [label="0..1", style=dotted]
    }

    subgraph Lookup4 {
        Lookup4_send   [label="{Lookup4/A|ADDR ⨉ FQDN\nserver, qname}"]
        Lookup4_answer [label="{Lookup4/Ans|FQDN ⨉ ADDR\nqname, address}"]
        Lookup4_send -> Lookup4_answer [label="0..", style=dotted]
    }

    subgraph Lookup6 {
        Lookup6_send   [label="{Lookup6/AAAA|ADDR ⨉ FQDN\nserver, qname}"]
        Lookup6_answer [label="{Lookup6/Ans|FQDN ⨉ ADDR\nqname, address}"]
        Lookup6_send -> Lookup6_answer [label="0..", style=dotted]
    }

    Domain [label="{Domain|FQDN ⨉ FQDN\nchild, parent}"]
    Auth   [label="{Auth|ADDR ⨉ FQDN\nserver, name}"]
    Zone   [label="{Zone|ADDR ⨉ FQDN\nserver, name}"]
    Oob    [label="{Oob|FQDN ⨉ FQDN\nqname, nsdname}"]
    Addr   [label="{Addr|FQDN ⨉ ADDR\nqname, address}"]

    node [shape=record]

    Target -> t1 [label="d"]
    t1 [label=< t<SUB>1</SUB>: p=parent(d) >]
    t1 -> Domain [label="(d, p)"]

    Hint -> t20 [label="s"]
    t20 [label=< t<SUB>20</SUB>: n="." >]
    t20 -> Auth [label="(s, n)"]

    Domain -> t2 [label="(_, c)", dir=both]
    t2 [label=<t<SUB>2</SUB>: p=parent(c)>]
    t2 -> Domain [label="(c, p)"]

    Domain -> t3 [label="(c, p)", dir=both]
    Auth -> t3 [label="(s, n)", dir=both]
    t3 [label=<t<SUB>3</SUB>: p=n>]
    t3 -> Down_send [label="(s, c)"]

    Down_nodata -> t4 [label="(s, q)"]
    t4 [label=< t<SUB>4</SUB> >]
    t4 -> Auth [label="(s, q)"]

    Down_answer -> t5 [label="(s, q)"]
    t5 [label=< t<SUB>5</SUB> >]
    t5 -> Auth [label="(s, q)"]
    t5 -> Zone [label="(s, q)"]

    Down_glue -> t13 [label="(q, a)"]
    t13 [label=< t<SUB>13</SUB> >]
    t13 -> Auth [label="(a, q)"]

    Down_ref -> t14 [label="(q, a)"]
    t14 [label=< t<SUB>14</SUB> >]
    t14 -> Oob [label="(a, q)"]

    Oob -> t6 [label="(_, n)", dir=both]
    t6 [label=<t<SUB>6</SUB>: p=parent(n)>]
    t6 -> Domain [label="(n, p)"]

    Oob -> t7 [label="(_, n)", dir=both]
    Auth -> t7 [label="(s, q)", dir=both]
    t7 [label=<t<SUB>7</SUB>: n=q>]
    t7 -> Lookup6_send [label="(s, q)"]
    t7 -> Lookup4_send [label="(s, q)"]

    Lookup4_answer -> t8 [label="(q, a)"]
    t8 [label=< t<SUB>8</SUB> >]
    t8 -> Addr [label="(q, a)"]

    Lookup6_answer -> t11 [label="(q, a)"]
    t11 [label=< t<SUB>11</SUB> >]
    t11 -> Addr [label="(q, a)"]

    Addr -> t12 [label="(q, a)", dir=both]
    Oob -> t12 [label="(d, n)", dir=both]
    t12 [label=<t<SUB>12</SUB>: q=n>]
    t12 -> Auth [label="(a, d)"]

    Auth -> t18 [label="(s, n)", dir=both]
    t18 [label=< t<SUB>18</SUB> >]
    t18 -> Self_send [label="(s, n)"]

    Self_answer -> t19 [label="(s, q)"]
    t19 [label=< t<SUB>19</SUB> >]
    t19 -> Zone [label="(s, q)"]

    Auth -> t15 [label="(s, n)", dir=both]
    t15 [label=< t<SUB>15</SUB> >]
    t15 -> Siblings_send [label="(s, n)"]

    Siblings_glue -> t16 [label="(q, a)"]
    t16 [label=< t<SUB>16</SUB> >]
    t16 -> Auth [label="(q, a)"]

    Siblings_ans -> t17 [label="(q, n)"]
    t17 [label=< t<SUB>17</SUB> >]
    t17 -> Oob [label="(q, n)"]
} 
